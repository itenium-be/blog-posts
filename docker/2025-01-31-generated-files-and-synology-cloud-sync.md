---
layout: post
author: Wouter Van Schandevijl
title: "Share files generated by Docker with Synology CloudSync"
subTitle: "Just what is going on here"
date: 2025-01-31
desc: >
  A CRON job running with docker-compose on our Synology
  creates files that are synced with a third party using
  CloudSync. But the files are not synced at their end??
bigimg:
  url: synology-docker-cloud-sync-big.png
  origin: Midjourney
  prompt: "docker whale in the clouds"
img:
  url: synology-docker-cloud-sync.png
  desc: ""
  origin: Midjourney
  prompt: "docker in the clouds"
categories: docker
tags: [synology]
interesting:
  - url: https://synocommunity.com/package/inotify-tools
    desc: "SynoCommunity package: inotify-tools"
  - url: https://www.synology.com/en-global/dsm/feature/cloud_sync
    desc: "Synology CloudSync"
  - url: https://www.reddit.com/r/synology/comments/pejrp5/files_created_by_docker_container_not_seen_by/
    desc: "Files created by docker container not seen by Synology Drive"
extras:
  - githubproject: https://github.com/itenium-be/synology-cloud-sync-vs-docker
    githubtext: "Minimal Example Code"
toc:
  title: CloudSync
  icon: server
socials:
  linkedin: ""
  instagram: ""
  twitter: ""
  facebook: ""
---

We needed to generate some files and share them with a third party.
They preferred we put the files on our SharePoint since they already had access to it.

So we made a `docker-compose` that scheduled a CRON
job to create the files in the shared folder.

The files were getting generated alright and other files were
getting synced alright, but the generated files were not!?

<!--more-->


# Synology Configuration

## Enable NFS

Steps: Control Panel > File Services > NFS > Enable

![Enabling NFS v4 on Synology](/assets/blog-images/synology-docker-cloud-sync-1-enable-nfs.png "Enabling NFS v4 on Synology"){: .img-responsive}

## Enable NFS on Shared Drive

- Control Panel > Shared Folder > right Click "workspace" > Edit > NFS Permissions
  - Create > Hostname or IP: 127.0.0.1 > Save

![Enabling NFS on Synology Shared Folder](/assets/blog-images/synology-docker-cloud-sync-2-nfs-for-cloud-sync-share.png "Enabling NFS on Synology Shared Folder"){: .img-responsive}


# The Code

## compose.yaml

Requires an `.env` file with with: `SYNC_DIR=/volume1/CloudSyncedFolder/shared-with-3rd-party`

```yaml
version: "3"

services:
  cron_job:
    # Sets up the CRON job
    build: .
    # Scheduled job write to /export
    volumes:
      - exportVolume:/export

volumes:
  # The required magic
  exportVolume:
    driver: local
    driver_opts:
      type: nfs
      o: nfsvers=4,addr=127.0.0.1,rw
      # The folder the job writes to
      # Shared with the 3rd party
      device: ":${SYNC_DIR}"
```

## Other files

[Minimal CRON job setup](https://github.com/itenium-be/synology-cloud-sync-vs-docker)
- Dockerfile: Copies `sh` files to the container and runs start.sh
- start.sh: Calls `crontab` to run create-file.sh and starts the deamon
- create-file.sh: `touch /export/export.csv`

# NFWhat?

NFS or [Network File System](https://en.wikipedia.org/wiki/Network_File_System),
a distributed file system protocol which allows you to access files over a network
as if they were on the local disk. It has been around since 1984 and is pretty much
the standard on Linux systems.

Thanks to NFS we get proper `inotify` events and CloudSync picks up our files.
Crisis averted!
